<Window
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:n="clr-namespace:Assembly.Helpers.Native"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	x:Class="Assembly.Metro.Dialogs.ControlDialogs.InjectSettings"
	xmlns:Vectors="clr-namespace:Assembly.Metro.Controls.Vectors"
	xmlns:local="clr-namespace:Assembly.Metro.Dialogs.ControlDialogs"
	AllowsTransparency="True" ResizeMode="CanResize" WindowStyle="None" WindowStartupLocation="CenterScreen"
	SnapsToDevicePixels="True" Title="Import Options" Height="464" Width="664"
	MaxWidth="550" MinHeight="464" MinWidth="664" ShowInTaskbar="True"
	n:WindowMovement.IsDraggable="True" x:Name="control">
	<Window.Resources>
		<local:ExistingTagConverter x:Key="tagToBoolConverter" TagsSource="{Binding Tags, Source={x:Reference control}}" />
	</Window.Resources>
	<Border Background="#FF2E2E31" BorderThickness="1,1,1,23" BorderBrush="{DynamicResource ExtryzeAccentBrush}">
		<Grid>
			<Grid Margin="0,0,0,5">
				<Grid.RowDefinitions>
					<RowDefinition Height="60px" />
					<RowDefinition Height="*" />
					<RowDefinition Height="36px" />
				</Grid.RowDefinitions>
				<Path IsHitTestVisible="False" Fill="{DynamicResource ExtryzeAccentBrush}"
				  Data="M898,1859C845,1855 757,1844 703,1835 613,1820 602,1816 571,1783 545,1755 518,1742 441,1718 307,1676 184,1611 106,1538 14,1454 12,1448 59,1411L98,1380 157,1437C295,1574 516,1650 860,1680 923,1685 1001,1690 1034,1690L1093,1690 1037,1628C1006,1593 977,1566 971,1567 966,1569 936,1542 906,1507L850,1445 901,1442C946,1439,957,1442,982,1467L1012,1495 1091,1410C1134,1363 1170,1323 1170,1320 1170,1317 1099,1316 1013,1318 926,1320 846,1319 835,1316 824,1313 807,1297 797,1280 780,1253 774,1250 726,1250L674,1250 531,1090 388,930 339,930 290,930 290,890 290,850 414,850C535,850 539,849 542,828 545,803 575,795 775,764 864,750 893,741 929,717L974,687 1189,698C1812,733,2092,844,2291,1135L2345,1215 2448,1218 2550,1221 2550,1260 2550,1300 2457,1300C2344,1300 2330,1308 2290,1396 2222,1547 2049,1671 1781,1760 1510,1851 1207,1885 898,1859z M1332,1679C1673,1642 1964,1475 1987,1302 1994,1246 1967,1171 1920,1117 1869,1059 1783,1003 1765,1016 1746,1029 1140,1678 1140,1685 1140,1693 1221,1691 1332,1679z M1406,1068L1522,935 1486,932C1456,929 1450,925 1450,906 1450,886 1443,881 1393,871 1361,865 1277,855 1205,849 1067,837 842,848 690,875L615,887 748,889C873,890 880,891 880,910 880,929 873,930 789,930 739,930 700,934 702,939 704,944 753,1004 813,1074L920,1200 1105,1200 1289,1200 1406,1068z"
				  Margin="6.443,5.656,0,0" VerticalAlignment="Top" HorizontalAlignment="Left" Height="33.557" Stretch="Fill"
				  Width="33.557" RenderTransformOrigin="0.5,0.5">
					<Path.RenderTransform>
						<TransformGroup>
							<ScaleTransform ScaleY="-0.5" />
							<SkewTransform />
							<RotateTransform />
							<TranslateTransform />
						</TransformGroup>
					</Path.RenderTransform>
				</Path>
				<TextBlock Grid.Row="0" x:Name="lblTitle" Text="Import Options" Foreground="#989898" VerticalAlignment="Top"
					   HorizontalAlignment="Stretch" FontSize="15" Margin="45,12,141,0"
					   FontFamily="{DynamicResource MetroFontLight}" TextTrimming="CharacterEllipsis" />

				<Grid
				Grid.Row="0"
				x:Name="headerThumb"
				Opacity="0"
				Background="Transparent"
				Margin="0,0,0,0" Height="53.5" VerticalAlignment="Top"
				n:WindowMovement.DragsWindow="True" />

				<Grid Grid.Row="1">
					<TabControl Background="{x:Null}" BorderBrush="{x:Null}" Foreground="{x:Null}" Margin="0">
						<TabItem Header="Options" Style="{StaticResource MetroHeaderTabItem}" Height="16" VerticalAlignment="Bottom" Margin="33,0,-33,0">

							<StackPanel Margin="15,15,15,0">
								<TextBlock TextWrapping="Wrap" Margin="0,0,0,4" Style="{StaticResource GenericTextblock}" Text="Note: The defaults here will apply to a majority of cases, only change if you know what you are doing!" />

								<CheckBox x:Name="keepsnd" Content="Keep Sound Tags" Margin="0,8,0,0" />
								<TextBlock Margin="32,0,0,0" TextWrapping="Wrap" Style="{StaticResource GenericTextblock}" FontSize="10" Text="Sounds are not supported at this time for non-Halo 4 and can make the game crash, so they are normally stripped out. This will inject sound tags anyway. For custom injection purposes ONLY outside of Halo 4." />

								<CheckBox x:Name="findraw" Content="Use Existing/Shared Raw Pages" Margin="0,8,0,0" IsChecked="True"/>
								<TextBlock Margin="32,0,0,0" TextWrapping="Wrap" Style="{StaticResource GenericTextblock}" FontSize="10" Text="Attempts to reduce map filesize and memory usage ingame by keeping shared resources shared and reusing pages that already exist. Only disable if you plan on adding a custom bitmap or other resource." />

								<CheckBox x:Name="injectraw" Content="Inject Raw Data" Margin="0,8,0,0" IsChecked="True"/>
								<TextBlock Margin="32,0,0,0" TextWrapping="Wrap" Style="{StaticResource GenericTextblock}" FontSize="10" Text="Raw data for tags will also be injected. This replaces the &quot;Extract With/Without Raw&quot; options of previous versions. Only disable if you plan on adding a custom bitmap or other resource. This will NOT override &quot;Use Existing/Shared&quot;!" />

								<CheckBox x:Name="uniqueshaders" Content="Unique Shaders" Margin="0,8,0,0" />
								<TextBlock Margin="32,0,0,0" TextWrapping="Wrap" Style="{StaticResource GenericTextblock}" FontSize="10" Text="In games past Halo 3/ODST, tags containing shader code can differ between maps due to stripping of unused data. This will rename affected tags so necessary tags always get injected. Disable at your own discretion, when on by default." />

							</StackPanel>
						</TabItem>
						<TabItem Header="Tags" Style="{StaticResource MetroHeaderTabItem}" Height="16" VerticalAlignment="Bottom" Margin="33,0,-33,0">
							<Grid Margin="15,15,15,0">
								<Grid.RowDefinitions>
									<RowDefinition Height="Auto"/>
									<RowDefinition Height="Auto"/>
									<RowDefinition Height="*"/>
								</Grid.RowDefinitions>

								<Grid Grid.Row="1">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="*" />
										<ColumnDefinition Width="Auto" />
									</Grid.ColumnDefinitions>
									<TextBlock Grid.Column="0" TextWrapping="Wrap" Style="{StaticResource GenericTextblock}" Text="Use this to rename any tag(s) to be injected via double-clicking. Tags without a plus icon won't be injected unless renamed, instead using the existing tag of the same name from this map."/>
									<ComboBox x:Name="tagClasses" Width="65" Margin="4,0,1,0" Grid.Column="1" SelectionChanged="tagClasses_SelectionChanged" VerticalAlignment="Bottom">
										<ComboBox.ItemTemplate>
											<ItemContainerTemplate>
												<TextBlock Text="{Binding Path=MagicString}" />
											</ItemContainerTemplate>
										</ComboBox.ItemTemplate>
									</ComboBox>

								</Grid>

								<Grid Grid.Row="2" Margin="-1,2,-1,-1">
									<Grid.RowDefinitions>
										<RowDefinition Height="*"/>
										<RowDefinition Height="Auto"/>
									</Grid.RowDefinitions>
									
									<ListBox x:Name="listTags"  Background="Transparent" MouseDoubleClick="listTags_MouseDoubleClick" Grid.Row="0">
										<ListBox.ItemTemplate>
											<ItemContainerTemplate>
												<Grid>
													<Grid.ColumnDefinitions>
														<ColumnDefinition Width="13" />
														<ColumnDefinition Width="*" />
													</Grid.ColumnDefinitions>
													<Path x:Name="CheckMark" Grid.Column="0" SnapsToDevicePixels="False" VerticalAlignment="Center" >
														<Path.Style>
															<Style TargetType="Path">
																<Setter Property="Stroke" Value="{DynamicResource ExtryzeAccentBrushSecondary}" />
																<Setter Property="StrokeThickness" Value="1.5" />
																<Setter Property="Data" Value="M 4.5 0 L 4.5 9 M 0 4.5 L 9 4.5" />
																<Style.Triggers>
																	<DataTrigger Binding="{Binding ., Mode=TwoWay, Converter={StaticResource tagToBoolConverter}}" Value="True">
																		<Setter Property="Visibility" Value="Hidden" />
																	</DataTrigger>
																</Style.Triggers>
															</Style>
														</Path.Style>
													</Path>
													<TextBlock Grid.Column="1" Text="{Binding Path=Name, UpdateSourceTrigger=PropertyChanged}"
															   ToolTip="{Binding Path=Name, UpdateSourceTrigger=PropertyChanged}">
														<TextBlock.Style>
															<Style TargetType="TextBlock" BasedOn="{StaticResource GenericTextblock}">
																<Style.Triggers>
																	<DataTrigger Binding="{Binding ., Mode=TwoWay, Converter={StaticResource tagToBoolConverter}}" Value="False">
																		<Setter Property="Foreground" Value="White" />
																	</DataTrigger>
																</Style.Triggers>
																
															</Style>
														</TextBlock.Style>
													</TextBlock>
												</Grid>
												
											</ItemContainerTemplate>
										</ListBox.ItemTemplate>
									</ListBox>

									<Expander Header="Replace" Grid.Row="1" Margin="2,1,2,0" Padding="1" ExpandDirection="Up">
										<Grid Background="#333337" Margin="-1,0,-1,-1">
											<Grid.RowDefinitions>
												<RowDefinition Height="Auto"/>
												<RowDefinition Height="Auto"/>
												<RowDefinition Height="Auto"/>
											</Grid.RowDefinitions>
											<Grid.ColumnDefinitions>
												<ColumnDefinition Width="Auto"/>
												<ColumnDefinition Width="*"/>
											</Grid.ColumnDefinitions>

											<TextBlock Text="Find What:" Grid.Row="0" Margin="4,0,0,0" VerticalAlignment="Center" />
											<TextBlock Text="Replace With:" Grid.Row="1" Margin="4,0,0,0" VerticalAlignment="Center"/>

											<TextBox x:Name="massRenameFind" Grid.Row="0" Grid.Column="1" Margin="4"/>
											<TextBox x:Name="massRenameReplace" Grid.Row="1" Grid.Column="1" Margin="4"/>

											<StackPanel Orientation="Horizontal" Grid.Row="2" Grid.Column="1"  Margin="4" HorizontalAlignment="Right">
												<TextBlock Text="(Case Sensitive)" Margin="0,0,8,0" VerticalAlignment="Center" />
												<CheckBox x:Name="renameClassOnly" Content="Current Class Only" VerticalAlignment="Center" />
												<Button Content="Replace All" Width="120" Margin="4,0,0,0" Click="MassRename_Click"/>
											</StackPanel>

										</Grid>

									</Expander>
									
								</Grid>

							</Grid>
							
						</TabItem>
					</TabControl>

				</Grid>
			</Grid>
			<Grid Margin="-1, -1, -1, -23">
				<!--Resize-->
				<Vectors:ResizeModule x:Name="ResizeDropVector" VerticalAlignment="Bottom" HorizontalAlignment="Right"
				                      Margin="0,0,5,5" Cursor="SizeNWSE" />
				<Thumb x:Name="ResizeDrop" DragDelta="ResizeDrop_DragDelta" Opacity="0" Background="{x:Null}" Foreground="{x:Null}"
				       Width="11" Height="11" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,1,1"
				       Cursor="SizeNWSE" />
			</Grid>

			<StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,20,5"
						VerticalAlignment="Bottom">
				<Button x:Name="btnOK" Padding="10,0,10,0" Margin="10,0,10,0" Click="btnOK_Click" Content="Inject"/>
				<Button x:Name="btnCancel" Padding="10,0,10,0" Margin="0" Click="btnCancel_Click" Content="Cancel"/>
			</StackPanel>

		</Grid>
	</Border>
</Window>